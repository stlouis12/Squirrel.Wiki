@model Squirrel.Wiki.Web.Models.SidebarItemViewModel

<li class="sidebar-nav-item">
    @if (Model.Type == Squirrel.Wiki.Web.Models.SidebarItemType.EmbeddedSearch)
    {
        @* Embedded search box *@
        <div class="sidebar-search-box">
            <form action="/Search" method="get" class="sidebar-search-form">
                <div class="input-group input-group-sm">
                    <input type="text" 
                           name="query" 
                           class="form-control" 
                           placeholder="@Model.Text" 
                           aria-label="Search">
                    <button class="btn btn-outline-secondary" type="submit" aria-label="Search">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </form>
        </div>
    }
    else if (Model.IsCollapsible)
    {
        @* Collapsible item with children *@
        var collapseId = $"sidebar-collapse-{Guid.NewGuid():N}";
        
        <div class="sidebar-collapsible-header d-flex align-items-center">
            @if (!string.IsNullOrEmpty(Model.Url))
            {
                @* Category with both link and children - show link + separate toggle *@
                <a href="@Model.Url" class="sidebar-nav-link flex-grow-1">
                    @Model.Text
                </a>
                <button class="sidebar-collapse-toggle btn btn-link p-1 ms-1" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#@collapseId" 
                        aria-expanded="false" 
                        aria-controls="@collapseId"
                        aria-label="Toggle @Model.Text submenu">
                    <i class="bi bi-chevron-down sidebar-collapse-icon"></i>
                </button>
            }
            else
            {
                @* Header without link - entire header is toggle *@
                <button class="sidebar-collapse-toggle btn btn-link text-start w-100 d-flex align-items-center justify-content-between p-0" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#@collapseId" 
                        aria-expanded="false" 
                        aria-controls="@collapseId">
                    <span class="sidebar-nav-header-text">@Model.Text</span>
                    <i class="bi bi-chevron-down sidebar-collapse-icon"></i>
                </button>
            }
        </div>
        
        <div class="collapse" id="@collapseId">
            <ul class="sidebar-nav-submenu">
                @foreach (var child in Model.Children)
                {
                    @await Html.PartialAsync("_SidebarItem", child)
                }
            </ul>
        </div>
    }
    else if (!string.IsNullOrEmpty(Model.Url))
    {
        @* Regular link item *@
        <a href="@Model.Url" class="sidebar-nav-link">
            @Model.Text
        </a>
    }
    else
    {
        @* Non-clickable header (shouldn't normally happen, but handle gracefully) *@
        <span class="sidebar-nav-header">@Model.Text</span>
    }
</li>
